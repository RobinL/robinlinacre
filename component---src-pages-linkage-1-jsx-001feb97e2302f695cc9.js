(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"7Sza":function(e,n,t){"use strict";t.r(n);t("q1tI"),t("DNiP"),t("SRfc"),t("rGqo"),t("yt8O"),t("Btvt"),t("RW0V"),t("0l/t"),t("bWfx");var i=t("h4VS"),r=(t("8+KV"),t("V+eJ"),t("dRSK"),t("o0o1")),a=t.n(r),o=(t("ls82"),t("HaE+")),u=(t("bHtr"),t("ODXe"));t("XfO3"),t("T39b"),t("f3/d"),t("Z2Ku"),t("L9s1"),t("91GP"),t("LK8F"),t("eM6i");function l(){var e=Object(i.a)(["*Clip art courtesy [ClipArt ETC](https://etc.usf.edu/clipart/), radio buttons and checkboxes courtesy [Amit Sch](https://beta.observablehq.com/@meetamit/multiple-choice-inputs).*"]);return l=function(){return e},e}function c(){var e=Object(i.a)(["License: [MIT](https://opensource.org/licenses/MIT)"]);return c=function(){return e},e}function s(){var e=Object(i.a)(['<div style="font-size: 0.85rem; font-style: italic;">',"</div>"]);return s=function(){return e},e}function f(){var e=Object(i.a)(['<div style="font: 700 0.9rem sans-serif;">',"</div>"]);return f=function(){return e},e}function d(){var e=Object(i.a)(['<output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.5em;"></output>']);return d=function(){return e},e}function m(){var e=Object(i.a)(['<input name=submit type=submit style="margin: 0 0.75em" value="','" />']);return m=function(){return e},e}function p(){var e=Object(i.a)(["<form>\n\t<input name=input type="," />\n  </form>"]);return p=function(){return e},e}function v(){var e=Object(i.a)(["<div></div>"]);return v=function(){return e},e}function b(){var e=Object(i.a)(["---\n## Wishlist (Send suggestions, please!)\n\n* 2D coordinate input (using an &lt;svg>)\n* 3D coordinate input (for say, positioning a camera in a WebGL sketch)\n* Geocoder search with location autocomplete that returns longitude and latitude.\n* Degrees or radians input, for circular things, or angles.\n* A dimensions input, or a box-model input, with margin (and optionally, padding).\n* A map-projection-picker input, rendering little thumbnails of all the d3-geo-projections.\n* Other useful formatting options.\n\n---"]);return b=function(){return e},e}function h(){var e=Object(i.a)(['---\n## Passwords\n\n~~~js\nimport {password} from "@jashkenas/inputs"\n~~~']);return h=function(){return e},e}function _(){var e=Object(i.a)(['---\n## Numbers\n\n~~~js\nimport {number} from "@jashkenas/inputs"\n~~~']);return _=function(){return e},e}function g(){var e=Object(i.a)(['<label style="display: inline-block; margin: 5px 10px 3px 0; font-size: 0.85em;">\n           ',"\n           ","\n          </label>"]);return g=function(){return e},e}function w(){var e=Object(i.a)(["<input type=checkbox name=input ",' style="vertical-align: baseline;" />']);return w=function(){return e},e}function y(){var e=Object(i.a)(["\n      <form>\n        ","\n      </form>\n    "]);return y=function(){return e},e}function j(){var e=Object(i.a)(['---\n## Checkboxes\n\n~~~js\nimport {checkbox} from "@jashkenas/inputs"\n~~~']);return j=function(){return e},e}function x(){var e=Object(i.a)(['\n          <label style="display: inline-block; margin: 5px 10px 3px 0; font-size: 0.85em;">\n           ',"\n           ","\n          </label>"]);return x=function(){return e},e}function k(){var e=Object(i.a)(["<input type=radio name=input ",' style="vertical-align: baseline;" />']);return k=function(){return e},e}function O(){var e=Object(i.a)(["\n      <form>\n        ","\n      </form>\n    "]);return O=function(){return e},e}function M(){var e=Object(i.a)(['---\n## Radio Buttons\n\n~~~js\nimport {radio} from "@jashkenas/inputs"\n~~~']);return M=function(){return e},e}function A(){var e=Object(i.a)(['<form><textarea style="display: block; font-size: 0.8em;" name=input>',"</textarea></form>"]);return A=function(){return e},e}function S(){var e=Object(i.a)(['---\n## Textareas\n\n~~~js\nimport {textarea} from "@jashkenas/inputs"\n~~~']);return S=function(){return e},e}function G(){var e=Object(i.a)(['---\n## Text Inputs\n\n~~~js\nimport {text} from "@jashkenas/inputs"\n~~~']);return G=function(){return e},e}function C(){var e=Object(i.a)(['<img height="125px" style="margin: 2px;" />']);return C=function(){return e},e}function D(){var e=Object(i.a)(["<div>"]);return D=function(){return e},e}function T(){var e=Object(i.a)(['---\n## File Upload\n*Use the JavaScript [File API](https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications) to work with uploaded file contents.*\n\n`import {file} from "@jashkenas/inputs"`'],['---\n## File Upload\n*Use the JavaScript [File API](https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications) to work with uploaded file contents.*\n\n\\`import {file} from "@jashkenas/inputs"\\`']);return T=function(){return e},e}function P(){var e=Object(i.a)([' ---\n## Times\n\n*value: a HH:MM:SS formatted string: * `"09:30:45"`\n<br>*(Time values are always in 24-hour format)*\n\n~~~js\nimport {time} from "@jashkenas/inputs"\n~~~'],[' ---\n## Times\n\n*value: a HH:MM:SS formatted string: * \\`"09:30:45"\\`\n<br>*(Time values are always in 24-hour format)*\n\n~~~js\nimport {time} from "@jashkenas/inputs"\n~~~']);return P=function(){return e},e}function q(){var e=Object(i.a)([' ---\n## Dates\n\n*value: a YYYY-MM-DD formatted string: * `"2016-11-08"` \n\n~~~js\nimport {date} from "@jashkenas/inputs"\n~~~'],[' ---\n## Dates\n\n*value: a YYYY-MM-DD formatted string: * \\`"2016-11-08"\\` \n\n~~~js\nimport {date} from "@jashkenas/inputs"\n~~~']);return q=function(){return e},e}function N(){var e=Object(i.a)(['<div style="position: absolute; width: ','px; white-space: nowrap; color: #444; text-align: center; font: 13px sans-serif; margin-top: -18px;">\n            <span style="color: #777;">Longitude:</span> ','\n            &nbsp; &nbsp; \n            <span style="color: #777;">Latitude:</span> '," \n          </div>"]);return N=function(){return e},e}function E(){var e=Object(i.a)(['<form style="width: ','px;"></form>']);return E=function(){return e},e}function I(){var e=Object(i.a)([' ---\n## U.S.A. Map Coordinates\n\n*value: an array pair of `[longitude, latitude]`, e.g. * `[-122.27, 37.87]` \n\n~~~js\nimport {usaMapCoordinates} from "@jashkenas/inputs"\n~~~'],[' ---\n## U.S.A. Map Coordinates\n\n*value: an array pair of \\`[longitude, latitude]\\`, e.g. * \\`[-122.27, 37.87]\\` \n\n~~~js\nimport {usaMapCoordinates} from "@jashkenas/inputs"\n~~~']);return I=function(){return e},e}function L(){var e=Object(i.a)(['<div style="position: absolute; width: ','px; white-space: nowrap; color: #444; text-align: center; font: 13px sans-serif; margin-top: -18px;">\n            <span style="color: #777;">Longitude:</span> ','\n            &nbsp; &nbsp; \n            <span style="color: #777;">Latitude:</span> '," \n          </div>"]);return L=function(){return e},e}function z(){var e=Object(i.a)(['<form style="width: ','px;"></form>']);return z=function(){return e},e}function V(){var e=Object(i.a)([' ---\n## World Map Coordinates\n\n*value: an array pair of `[longitude, latitude]`, e.g. * `[-122.27, 37.87]` \n\n~~~js\nimport {worldMapCoordinates} from "@jashkenas/inputs"\n~~~'],[' ---\n## World Map Coordinates\n\n*value: an array pair of \\`[longitude, latitude]\\`, e.g. * \\`[-122.27, 37.87]\\` \n\n~~~js\nimport {worldMapCoordinates} from "@jashkenas/inputs"\n~~~']);return V=function(){return e},e}function W(){var e=Object(i.a)(['\n      <form>\n        <label style="display: inline-block; font: 600 0.8rem sans-serif; margin: 6px 0 0;">\n          <span style="display: inline-block; width: 70px;">Longitude:</span>\n          ','\n        </label>\n        <br>\n        <label style="display: inline-block; font: 600 0.8rem sans-serif; margin: 0 0 6px;">\n          <span style="display: inline-block; width: 70px;">Latitude:</span>\n          ',"\n        </label>\n      </form>\n    "]);return W=function(){return e},e}function B(){var e=Object(i.a)(['<input name="input" type="number" autocomplete="off" min="-90" max="90" style="width: 80px;" step="any" value="','" />']);return B=function(){return e},e}function F(){var e=Object(i.a)(['<input name="input" type="number" autocomplete="off" min="-180" max="180" style="width: 80px;" step="any" value="','" />']);return F=function(){return e},e}function R(){var e=Object(i.a)([' ---\n## Coordinates\n\n*value: an array pair of `[longitude, latitude]`, e.g. * `[-122.27, 37.87]` \n\n~~~js\nimport {coordinates} from "@jashkenas/inputs"\n~~~'],[' ---\n## Coordinates\n\n*value: an array pair of \\`[longitude, latitude]\\`, e.g. * \\`[-122.27, 37.87]\\` \n\n~~~js\nimport {coordinates} from "@jashkenas/inputs"\n~~~']);return R=function(){return e},e}function U(){var e=Object(i.a)(['---\n## Color Pickers\n\n*value: a hexadecimal string, e.g. * `"#bada55"` \n\n~~~js\nimport {color} from "@jashkenas/inputs"\n~~~'],['---\n## Color Pickers\n\n*value: a hexadecimal string, e.g. * \\`"#bada55"\\` \n\n~~~js\nimport {color} from "@jashkenas/inputs"\n~~~']);return U=function(){return e},e}function Y(){var e=Object(i.a)(["<option>"]);return Y=function(){return e},e}function H(){var e=Object(i.a)(['\n      <form>\n         <input name="input" type="text" autocomplete="off" \n          placeholder="','" style="font-size: 1em;" list=','>\n          <datalist id="','">\n              ',"\n          </datalist>\n      </form>\n      "]);return H=function(){return e},e}function J(){var e=Object(i.a)(['---\n## Autoselects\n*A variant of an option menu, using an autocompleting text input, via HTML‚Äôs datalist element.* \n\n~~~js\nimport {autoSelect} from "@jashkenas/inputs"\n~~~']);return J=function(){return e},e}function K(){var e=Object(i.a)(["<option>"]);return K=function(){return e},e}function Q(){var e=Object(i.a)(['\n      <form>\n        <select name="input" ',">\n          ","\n        </select>\n      </form>\n    "]);return Q=function(){return e},e}function Z(){var e=Object(i.a)(['---\n## Dropdown Menus and Multiselects\n\n~~~js\nimport {select} from "@jashkenas/inputs"\n~~~']);return Z=function(){return e},e}function X(){var e=Object(i.a)(['---\n## Buttons\n\n~~~js\nimport {button} from "@jashkenas/inputs"\n~~~']);return X=function(){return e},e}function $(){var e=Object(i.a)(["More [fancy slider techniques](https://beta.observablehq.com/@mootari/prime-numbers-slider)."]);return $=function(){return e},e}function ee(){var e=Object(i.a)(['---\n## Sliders\n\n~~~js\nimport {slider} from "@jashkenas/inputs"\n~~~']);return ee=function(){return e},e}function ne(){var e=Object(i.a)(["| <h3>Friends & Family:</h3>  |   |\n|---|---|\n| **[@mbostock/form-input](/@mbostock/form-input)**  | Fully custom forms, combining inputs into a single reactive cell. |\n| **[@zechasault/color-schemes-and-interpolators-picker](/@zechasault/color-schemes-and-interpolators-picker)**  | Color scheme and interoplation pickers. |\n| **[@mootari/range-slider](https://observablehq.com/@mootari/range-slider)**  |  True range sliders, setting both a minimum and maximum value. |\n| **[@bumbeishvili/data-driven-range-sliders](/@bumbeishvili/data-driven-range-sliders)** | Data-driven range sliders, displaying a distribution histogram of the underlying data. |\n| **[@trebor/snapping-histogram-slider](/@trebor/snapping-histogram-slider)** | Another data-driven range slider option. |\n| **[@mootari‚Äôs 2D Slider](https://observablehq.com/d/98bbb19bf9e859ee)** | Two dimensional sliders, exploring discrete points on a plane. |\n| **[@yurivish/ternary-slider](/@yurivish/ternary-slider)** | Nifty ternary plot inputs, describing the percentages of a whole composed of exactly three things. |\n\n\n<br>*If you have any improvements for the bazaar, [please make your change in a fork and send it to me as a suggestion.](https://observablehq.com/@observablehq/suggestions-and-comments)*"]);return ne=function(){return e},e}function te(e,n){var t=e.module();return t.variable(n()).define(["md"],(function(e){return e(ne())})),t.variable(n("sliderDemo")).define("sliderDemo",["md"],(function(e){return e(ee())})),t.variable(n("viewof a")).define("viewof a",["slider"],(function(e){return e()})),t.variable(n("a")).define("a",["Generators","viewof a"],(function(e,n){return e.input(n)})),t.variable(n("viewof a1")).define("viewof a1",["slider"],(function(e){return e({min:0,max:1,step:.01,format:".0%",description:"Zero to one, formatted as a percentage"})})),t.variable(n("a1")).define("a1",["Generators","viewof a1"],(function(e,n){return e.input(n)})),t.variable(n("viewof a1_1")).define("viewof a1_1",["slider"],(function(e){return e({min:0,max:1,step:.01,format:function(e){return"".concat(Math.round(100*e)," per cent")},description:"Zero to one, formatted with a custom function"})})),t.variable(n("a1_1")).define("a1_1",["Generators","viewof a1_1"],(function(e,n){return e.input(n)})),t.variable(n("viewof a2")).define("viewof a2",["slider"],(function(e){return e({min:0,max:1e9,step:1e3,value:325e4,format:",",description:"Zero to one billion, in steps of one thousand, formatted as a (US) number"})})),t.variable(n("a2")).define("a2",["Generators","viewof a2"],(function(e,n){return e.input(n)})),t.variable(n("viewof a3")).define("viewof a3",["slider"],(function(e){return e({min:0,max:100,step:1,value:10,title:"Integers",description:"Integers from zero through 100"})})),t.variable(n("a3")).define("a3",["Generators","viewof a3"],(function(e,n){return e.input(n)})),t.variable(n("viewof a4")).define("viewof a4",["slider"],(function(e){return e({min:.9,max:1.1,precision:3,description:"A high precision slider example"})})),t.variable(n("a4")).define("a4",["Generators","viewof a4"],(function(e,n){return e.input(n)})),t.variable(n("viewof a5")).define("viewof a5",["slider"],(function(e){return e({min:.9,max:1.1,precision:3,submit:!0,description:"The same as a4, but only changes value on submit"})})),t.variable(n("a5")).define("a5",["Generators","viewof a5"],(function(e,n){return e.input(n)})),t.variable(n()).define(["md"],(function(e){return e($())})),t.variable(n("slider")).define("slider",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="number"==typeof n?{value:n}:n,i=t.min,r=void 0===i?0:i,a=t.max,o=void 0===a?1:a,u=t.value,l=void 0===u?(o+r)/2:u,c=t.step,s=void 0===c?"any":c,f=t.precision,d=void 0===f?2:f,m=t.title,p=t.description,v=t.getValue,b=t.format,h=t.display,_=t.submit;return d=Math.pow(10,d),v||(v=function(e){return Math.round(e.valueAsNumber*d)/d}),e({type:"range",title:m,description:p,submit:_,format:b,display:h,attributes:{min:r,max:o,step:s,value:l},getValue:v})}})),t.variable(n("buttonDemo")).define("buttonDemo",["md"],(function(e){return e(X())})),t.variable(n("viewof b")).define("viewof b",["button"],(function(e){return e()})),t.variable(n("b")).define("b",["Generators","viewof b"],(function(e,n){return e.input(n)})),t.variable(n()).define(["b"],(function(e){return!this})),t.variable(n("viewof b1")).define("viewof b1",["button"],(function(e){return e({value:"Click me",description:"We use a reference to the button below to record the time you pressed it."})})),t.variable(n("b1")).define("b1",["Generators","viewof b1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["b1"],(function(e){return new Date(Date.now()).toUTCString()})),t.variable(n("button")).define("button",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="string"==typeof n?{value:n}:n,i=t.value,r=void 0===i?"Ok":i,a=t.title,o=t.description,u=t.disabled,l=e({type:"button",title:a,description:o,attributes:{disabled:u,value:r}});return l.output.remove(),l}})),t.variable(n("selectDemo")).define("selectDemo",["md"],(function(e){return e(Z())})),t.variable(n("viewof dd")).define("viewof dd",["select"],(function(e){return e(["Spring","Summer","Fall","Winter"])})),t.variable(n("dd")).define("dd",["Generators","viewof dd"],(function(e,n){return e.input(n)})),t.variable(n()).define(["dd"],(function(e){return e})),t.variable(n("viewof dd1")).define("viewof dd1",["select"],(function(e){return e({title:"Stooges",description:"Please pick your favorite stooge.",options:["Curly","Larry","Moe","Shemp"],value:"Moe"})})),t.variable(n("dd1")).define("dd1",["Generators","viewof dd1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["dd1"],(function(e){return e})),t.variable(n("viewof dd2")).define("viewof dd2",["select"],(function(e){return e({description:"As a child, which vegetables did you refuse to eat?",options:["Spinach","Broccoli","Brussels Sprouts","Cauliflower","Kale","Turnips","Green Beans","Asparagus"],multiple:!0})})),t.variable(n("dd2")).define("dd2",["Generators","viewof dd2"],(function(e,n){return e.input(n)})),t.variable(n()).define(["dd2"],(function(e){return e})),t.variable(n("viewof dd3")).define("viewof dd3",["select"],(function(e){var n=e({title:"How are you feeling today?",options:[{label:"ü§∑",value:"shrug"},{label:"üòÇ",value:"tears-of-joy"},{label:"üòç",value:"loving-it"},{label:"ü§î",value:"hmmm"},{label:"üò±",value:"yikes"},{label:"üòà",value:"mischievous"},{label:"üí©",value:"poo"}],value:"hmmm"});return n.input.style.fontSize="30px",n.input.style.marginTop="8px",n})),t.variable(n("dd3")).define("dd3",["Generators","viewof dd3"],(function(e,n){return e.input(n)})),t.variable(n()).define(["dd3"],(function(e){return e})),t.variable(n("select")).define("select",["input","html"],(function(e,n){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(t)?{options:t}:t,r=i.value,a=i.title,o=i.description,u=i.submit,l=i.multiple,c=i.size,s=i.options;s=s.map((function(e){return"object"==typeof e?e:{value:e,label:e}}));var f=e({type:"select",title:a,description:o,submit:u,getValue:function(e){var n=Array.prototype.filter.call(e.options,(function(e){return e.selected})).map((function(e){return e.value}));return l?n:n[0]},form:n(Q(),l?'multiple size="'.concat(c||s.length,'"'):"",s.map((function(e){var t=e.value,i=e.label;return Object.assign(n(K()),{value:t,selected:Array.isArray(r)?r.includes(t):r===t,textContent:i})})))});return f.output.remove(),f}})),t.variable(n("autoSelectDemo")).define("autoSelectDemo",["md"],(function(e){return e(J())})),t.variable(n("viewof as")).define("viewof as",["autoSelect","usa"],(function(e,n){return e({options:n.objects.states.geometries.map((function(e){return e.properties.name})),placeholder:"Search for a US state . . ."})})),t.variable(n("as")).define("as",["Generators","viewof as"],(function(e,n){return e.input(n)})),t.variable(n()).define(["as"],(function(e){return e})),t.variable(n("autoSelect")).define("autoSelect",["input","html"],(function(e,n){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(t)?{options:t}:t,r=i.value,a=i.title,o=i.description,u=(i.autocomplete,i.placeholder),l=(i.size,i.options),c=i.list,s=void 0===c?"options":c,f=new Set(l),d=e({type:"text",title:a,description:o,action:function(e){e.value=e.input.value=r||"",e.onsubmit=function(e){return e.preventDefault()},e.input.oninput=function(n){n.stopPropagation(),e.value=e.input.value,f.has(e.input.value)&&e.dispatchEvent(new CustomEvent("input"))}},form:n(H(),u,s,s,l.map((function(e){return Object.assign(n(Y()),{value:e})})))});return d.output.remove(),d}})),t.variable(n("colorDemo")).define("colorDemo",["md"],(function(e){return e(U())})),t.variable(n("viewof c")).define("viewof c",["color"],(function(e){return e()})),t.variable(n("c")).define("c",["Generators","viewof c"],(function(e,n){return e.input(n)})),t.variable(n("viewof c1")).define("viewof c1",["color"],(function(e){return e({value:"#0000ff",title:"Background Color",description:"This color picker starts out blue"})})),t.variable(n("c1")).define("c1",["Generators","viewof c1"],(function(e,n){return e.input(n)})),t.variable(n("color")).define("color",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="string"==typeof n?{value:n}:n,i=t.value,r=void 0===i?"#000000":i,a=t.title,o=t.description,u=t.submit,l=t.display,c=e({type:"color",title:a,description:o,submit:u,display:l,attributes:{value:r}});return(a||o)&&(c.input.style.margin="5px 0"),c}})),t.variable(n("coordinatesDemo")).define("coordinatesDemo",["md"],(function(e){return e(R())})),t.variable(n("viewof coords1")).define("viewof coords1",["coordinates"],(function(e){return e()})),t.variable(n("coords1")).define("coords1",["Generators","viewof coords1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["coords1"],(function(e){return e})),t.variable(n("viewof coords2")).define("viewof coords2",["coordinates"],(function(e){return e({title:"Hometown",description:"Enter the coordinates of where you were born",value:[-122.27,37.87],submit:!0})})),t.variable(n("coords2")).define("coords2",["Generators","viewof coords2"],(function(e,n){return e.input(n)})),t.variable(n()).define(["coords2"],(function(e){return e})),t.variable(n("coordinates")).define("coordinates",["html","input"],(function(e,n){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(t)?{value:t}:t,r=i.value,a=void 0===r?[]:r,o=i.title,l=i.description,c=i.submit,s=Object(u.a)(a,2),f=s[0],d=s[1];f=null!=f?f:"",d=null!=d?d:"";var m=e(F(),f),p=e(B(),d),v=n({type:"coordinates",title:o,description:l,submit:c,getValue:function(){var e=m.valueAsNumber,n=p.valueAsNumber;return[isNaN(e)?null:e,isNaN(n)?null:n]},form:e(W(),m,p)});return v.output.remove(),v}})),t.variable(n("worldMapCoordinatesDemo")).define("worldMapCoordinatesDemo",["md"],(function(e){return e(V())})),t.variable(n("viewof worldMap1")).define("viewof worldMap1",["worldMapCoordinates"],(function(e){return e([-122.27,37.87])})),t.variable(n("worldMap1")).define("worldMap1",["Generators","viewof worldMap1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["worldMap1"],(function(e){return e})),t.variable(n("worldMapCoordinates")).define("worldMapCoordinates",["html","DOM","d3geo","graticule","land","countries","input"],(function(e,n,t,i,r,a,o){return function(){var l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=Array.isArray(l)?{value:l}:l,s=c.value,f=void 0===s?[]:s,d=c.title,m=c.description,p=c.width,v=void 0===p?400:p,b=Math.round(.525*v),h=Object(u.a)(f,2),_=h[0],g=h[1];_=null!=_?_:null,g=null!=g?g:null;var w=e(z(),v),y=n.context2d(v,b),j=y.canvas;j.style.margin="10px 0 0";var x=t.geoNaturalEarth1().precision(.1).fitSize([v,b],{type:"Sphere"}),k=t.geoPath(x,y).pointRadius(2.5);function O(){if(y.fillStyle="#fff",y.fillRect(0,0,v,b),y.beginPath(),k(i),y.lineWidth=.35,y.strokeStyle="#ddd",y.stroke(),y.beginPath(),k(r),y.fillStyle="#f4f4f4",y.fill(),y.beginPath(),k(a),y.strokeStyle="#aaa",y.stroke(),null!=_&&null!=g){var e={type:"MultiPoint",coordinates:[[_,g]]};y.beginPath(),k(e),y.fillStyle="#f00",y.fill()}}w.append(j),j.onclick=function(e){var n=e.offsetX,t=e.offsetY,i=x.invert([n,t]);_=+i[0].toFixed(2),g=+i[1].toFixed(2),O(),j.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},O();var M=o({type:"worldMapCoordinates",title:d,description:m,display:function(n){return e(L(),v,null!=_?_:"",null!=g?g:"")},getValue:function(){return[null!=_?_:null,null!=g?g:null]},form:w});return M}})),t.variable(n("usaMapCoordinatesDemo")).define("usaMapCoordinatesDemo",["md"],(function(e){return e(I())})),t.variable(n("viewof usaMap1")).define("viewof usaMap1",["usaMapCoordinates"],(function(e){return e([-122.27,37.87])})),t.variable(n("usaMap1")).define("usaMap1",["Generators","viewof usaMap1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["usaMap1"],(function(e){return e})),t.variable(n("viewof usaMap2")).define("viewof usaMap2",["usaMapCoordinates"],(function(e){return e({title:"A Mini Map",description:"Defaults to New York City",width:200,value:[-74,40.71]})})),t.variable(n("usaMap2")).define("usaMap2",["Generators","viewof usaMap2"],(function(e,n){return e.input(n)})),t.variable(n()).define(["usaMap2"],(function(e){return e})),t.variable(n("usaMapCoordinates")).define("usaMapCoordinates",["html","DOM","d3geo","nation","states","input"],(function(e,n,t,i,r,a){return function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=Array.isArray(o)?{value:o}:o,c=l.value,s=void 0===c?[]:c,f=l.title,d=l.description,m=l.width,p=void 0===m?400:m,v=p/960,b=600*v,h=Object(u.a)(s,2),_=h[0],g=h[1];_=null!=_?_:null,g=null!=g?g:null;var w=e(E(),p),y=n.context2d(p,b),j=y.canvas;j.style.margin="5px 0 0";var x=t.geoAlbersUsa().scale(1280).translate([480,300]),k=t.geoPath().context(y).pointRadius(2.5/v);function O(){if(y.clearRect(0,0,p,b),y.save(),y.scale(v,v),y.lineWidth=.35/v,y.beginPath(),k(i),y.fillStyle="#f4f4f4",y.fill(),y.beginPath(),k(r),y.strokeStyle="#aaa",y.stroke(),null!=_&&null!=g){var e={type:"MultiPoint",coordinates:[x([_,g])]};y.beginPath(),k(e),y.fillStyle="#f00",y.fill()}y.restore()}w.append(j),j.onclick=function(e){var n=e.offsetX,t=e.offsetY,i=x.invert([n/v,t/v]);_=+i[0].toFixed(2),g=+i[1].toFixed(2),O(),j.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},O();var M=a({type:"worldMapCoordinates",title:f,description:d,display:function(n){return e(N(),p,null!=_?_:"",null!=g?g:"")},getValue:function(){return[null!=_?_:null,null!=g?g:null]},form:w});return M}})),t.variable(n("dateDemo")).define("dateDemo",["md"],(function(e){return e(q())})),t.variable(n("viewof d")).define("viewof d",["date"],(function(e){return e()})),t.variable(n("d")).define("d",["Generators","viewof d"],(function(e,n){return e.input(n)})),t.variable(n("viewof d1")).define("viewof d1",["date"],(function(e){return e({title:"2017",min:"2017-01-01",max:"2017-12-31",value:"2017-01-01",description:"Only dates within the 2017 calendar year are allowed"})})),t.variable(n("d1")).define("d1",["Generators","viewof d1"],(function(e,n){return e.input(n)})),t.variable(n("date")).define("date",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="string"==typeof n?{value:n}:n,i=t.min,r=t.max,a=t.value,o=t.title,u=t.description,l=t.display;return e({type:"date",title:o,description:u,display:l,attributes:{min:i,max:r,value:a}})}})),t.variable(n("timeDemo")).define("timeDemo",["md"],(function(e){return e(P())})),t.variable(n("viewof t")).define("viewof t",["time"],(function(e){return e()})),t.variable(n("t")).define("t",["Generators","viewof t"],(function(e,n){return e.input(n)})),t.variable(n()).define(["t"],(function(e){return e})),t.variable(n("viewof t1")).define("viewof t1",["time"],(function(e){return e({title:"Afternoon",min:"12:00:00",max:"23:59:59",value:"13:00:00",step:1,description:"Only times after noon are allowed, and seconds are included"})})),t.variable(n("t1")).define("t1",["Generators","viewof t1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["t1"],(function(e){return e})),t.variable(n("time")).define("time",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="string"==typeof n?{value:n}:n,i=t.min,r=t.max,a=t.step,o=t.value,u=t.title,l=t.description,c=t.display,s=e({type:"time",title:u,description:l,display:c,getValue:function(e){return e.value?e.value:void 0},attributes:{min:i,max:r,step:a,value:o}});return s.output.remove(),s}})),t.variable(n("fileDemo")).define("fileDemo",["md"],(function(e){return e(T())})),t.variable(n("viewof e")).define("viewof e",["file"],(function(e){return e()})),t.variable(n("e")).define("e",["Generators","viewof e"],(function(e,n){return e.input(n)})),t.variable(n("viewof e1")).define("viewof e1",["file"],(function(e){return e({title:"Photographs",description:"Only .jpg files are allowed in this example. Choose some images, and they‚Äôll appear in the cell below.",accept:".jpg",multiple:!0})})),t.variable(n("e1")).define("e1",["Generators","viewof e1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["html","e1","Files"],function(){var e=Object(o.a)(a.a.mark((function e(n,t,i){var r,o,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n(D()),o=0;case 2:if(!(o<t.length)){e.next=12;break}return t[o],u=n(C()),e.next=7,i.url(t[o]);case 7:u.src=e.sent,r.append(u);case 9:o++,e.next=2;break;case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})));return function(n,t,i){return e.apply(this,arguments)}}()),t.variable(n("file")).define("file",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.multiple,i=n.accept,r=n.title,a=n.description,o=e({type:"file",title:r,description:a,attributes:{multiple:t,accept:i},action:function(e){e.input.onchange=function(){e.value=t?e.input.files:e.input.files[0],e.dispatchEvent(new CustomEvent("input"))}}});return o.output.remove(),o.input.onchange(),o}})),t.variable(n("textDemo")).define("textDemo",["md"],(function(e){return e(G())})),t.variable(n("viewof f")).define("viewof f",["text"],(function(e){return e()})),t.variable(n("f")).define("f",["Generators","viewof f"],(function(e,n){return e.input(n)})),t.variable(n("viewof f1")).define("viewof f1",["text"],(function(e){return e({title:"A Text Input",placeholder:"Placeholder text",description:"Note that text inputs don‚Äôt show output on the right"})})),t.variable(n("f1")).define("f1",["Generators","viewof f1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["f1"],(function(e){return e})),t.variable(n("viewof f2")).define("viewof f2",["text"],(function(e){return e({placeholder:"Placeholder text",description:"This input only changes value on submit",submit:"Go"})})),t.variable(n("f2")).define("f2",["Generators","viewof f2"],(function(e,n){return e.input(n)})),t.variable(n()).define(["f2"],(function(e){return e})),t.variable(n("text")).define("text",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="string"==typeof n?{value:n}:n,i=t.value,r=t.title,a=t.description,o=t.autocomplete,u=void 0===o?"off":o,l=t.maxlength,c=t.minlength,s=t.pattern,f=t.placeholder,d=t.size,m=t.submit,p=e({type:"text",title:r,description:a,submit:m,attributes:{value:i,autocomplete:u,maxlength:l,minlength:c,pattern:s,placeholder:f,size:d}});return p.output.remove(),p.input.style.fontSize="1em",p}})),t.variable(n("textareaDemo")).define("textareaDemo",["md"],(function(e){return e(S())})),t.variable(n("viewof g")).define("viewof g",["textarea"],(function(e){return e()})),t.variable(n("g")).define("g",["Generators","viewof g"],(function(e,n){return e.input(n)})),t.variable(n()).define(["g"],(function(e){return e})),t.variable(n("viewof g1")).define("viewof g1",["textarea"],(function(e){return e({title:"Your Great American Novel",placeholder:"Insert story here...",spellcheck:!0,width:"100%",rows:10,submit:"Publish"})})),t.variable(n("g1")).define("g1",["Generators","viewof g1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["g1"],(function(e){return e})),t.variable(n("textarea")).define("textarea",["input","html"],(function(e,n){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i="string"==typeof t?{value:t}:t,r=i.value,a=void 0===r?"":r,o=i.title,u=i.description,l=i.autocomplete,c=i.cols,s=void 0===c?45:c,f=i.rows,d=void 0===f?3:f,m=i.width,p=i.height,v=i.maxlength,b=i.placeholder,h=i.spellcheck,_=i.wrap,g=i.submit,w=e({form:n(A(),a),title:o,description:u,submit:g,attributes:{autocomplete:l,cols:s,rows:d,maxlength:v,placeholder:b,spellcheck:h,wrap:_}});return w.output.remove(),null!=m&&(w.input.style.width=m),null!=p&&(w.input.style.height=p),g&&(w.submit.style.margin="0"),(o||u)&&(w.input.style.margin="3px 0"),w}})),t.variable(n("radioDemo")).define("radioDemo",["md"],(function(e){return e(M())})),t.variable(n("viewof r")).define("viewof r",["radio"],(function(e){return e(["Lust","Gluttony","Greed","Sloth","Wrath","Envy","Pride"])})),t.variable(n("r")).define("r",["Generators","viewof r"],(function(e,n){return e.input(n)})),t.variable(n()).define(["r"],(function(e){return e})),t.variable(n("viewof r1")).define("viewof r1",["radio"],(function(e){return e({title:"Contact Us",description:"Please select your preferred contact method",options:[{label:"By Email",value:"email"},{label:"By Phone",value:"phone"},{label:"By Pager",value:"pager"}],value:"pager"})})),t.variable(n("r1")).define("r1",["Generators","viewof r1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["r1"],(function(e){return e})),t.variable(n("radio")).define("radio",["input","html"],(function(e,n){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(t)?{options:t}:t,r=i.value,a=i.title,o=i.description,u=i.submit,l=i.options;l=l.map((function(e){return"string"==typeof e?{value:e,label:e}:e}));var c=e({type:"radio",title:a,description:o,submit:u,getValue:function(e){if(e.checked)return e.value;var n=Array.prototype.find.call(e,(function(e){return e.checked}));return n?n.value:void 0},form:n(O(),l.map((function(e){var t=e.value,i=e.label,a=n(k(),t===r?"checked":"");return a.setAttribute("value",t),n(x(),a,i)})))});return c.output.remove(),c}})),t.variable(n("checkboxDemo")).define("checkboxDemo",["md"],(function(e){return e(j())})),t.variable(n("viewof ch")).define("viewof ch",["checkbox"],(function(e){return e(["Lust","Gluttony","Greed","Sloth","Wrath","Envy","Pride"])})),t.variable(n("ch")).define("ch",["Generators","viewof ch"],(function(e,n){return e.input(n)})),t.variable(n()).define(["ch"],(function(e){return e})),t.variable(n("viewof ch1")).define("viewof ch1",["checkbox"],(function(e){return e({title:"Colors",description:"Please select your favorite colors",options:[{value:"r",label:"Red"},{value:"o",label:"Orange"},{value:"y",label:"Yellow"},{value:"g",label:"Green"},{value:"b",label:"Blue"},{value:"i",label:"Indigo"},{value:"v",label:"Violet"}],value:["r","g","b"],submit:!0})})),t.variable(n("ch1")).define("ch1",["Generators","viewof ch1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["ch1"],(function(e){return e})),t.variable(n("viewof ch3")).define("viewof ch3",["checkbox"],(function(e){return e({description:"Just a single checkbox to toggle",options:[{value:"toggle",label:"On"}],value:"toggle"})})),t.variable(n("ch3")).define("ch3",["Generators","viewof ch3"],(function(e,n){return e.input(n)})),t.variable(n()).define(["ch3"],(function(e){return e})),t.variable(n("checkbox")).define("checkbox",["input","html"],(function(e,n){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Array.isArray(t)?{options:t}:t,r=i.value,a=i.title,o=i.description,u=i.submit,l=i.options;l=l.map((function(e){return"string"==typeof e?{value:e,label:e}:e}));var c=e({type:"checkbox",title:a,description:o,submit:u,getValue:function(e){return e.length?Array.prototype.filter.call(e,(function(e){return e.checked})).map((function(e){return e.value})):!!e.checked&&e.value},form:n(y(),l.map((function(e){var t=e.value,i=e.label,a=n(w(),(r||[]).indexOf(t)>-1?"checked":"");return a.setAttribute("value",t),n(g(),a,i)})))});return c.output.remove(),c}})),t.variable(n("numberDemo")).define("numberDemo",["md"],(function(e){return e(_())})),t.variable(n("viewof h")).define("viewof h",["number"],(function(e){return e()})),t.variable(n("h")).define("h",["Generators","viewof h"],(function(e,n){return e.input(n)})),t.variable(n()).define(["h"],(function(e){return e})),t.variable(n("viewof h1")).define("viewof h1",["number"],(function(e){return e({placeholder:"13+",title:"Your Age",submit:!0})})),t.variable(n("h1")).define("h1",["Generators","viewof h1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["h1"],(function(e){return e})),t.variable(n("number")).define("number",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="number"==typeof n||"string"==typeof n?{value:+n}:n,i=t.value,r=t.title,a=t.description,o=t.placeholder,u=t.submit,l=t.step,c=void 0===l?"any":l,s=t.min,f=t.max,d=e({type:"number",title:r,description:a,submit:u,attributes:{value:i,placeholder:o,step:c,min:s,max:f,autocomplete:"off"},getValue:function(e){return e.valueAsNumber}});return d.output.remove(),d.input.style.width="auto",d.input.style.fontSize="1em",d}})),t.variable(n("passwordDemo")).define("passwordDemo",["md"],(function(e){return e(h())})),t.variable(n("viewof i")).define("viewof i",["password"],(function(e){return e({value:"password"})})),t.variable(n("i")).define("i",["Generators","viewof i"],(function(e,n){return e.input(n)})),t.variable(n()).define(["i"],(function(e){return e})),t.variable(n("viewof i1")).define("viewof i1",["password"],(function(e){return e({title:"Your super secret password",description:"Less than 12 characters, please.",minlength:6,maxlength:12})})),t.variable(n("i1")).define("i1",["Generators","viewof i1"],(function(e,n){return e.input(n)})),t.variable(n()).define(["i1"],(function(e){return e})),t.variable(n("password")).define("password",["input"],(function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="string"==typeof n?{value:n}:n,i=t.value,r=t.title,a=t.description,o=t.autocomplete,u=void 0===o?"off":o,l=t.maxlength,c=t.minlength,s=t.pattern,f=t.placeholder,d=t.size,m=t.submit,p=e({type:"password",title:r,description:a,submit:m,attributes:{value:i,autocomplete:u,maxlength:l,minlength:c,pattern:s,placeholder:f,size:d}});return p.output.remove(),p.input.style.fontSize="1em",p}})),t.variable(n()).define(["md"],(function(e){return e(b())})),t.variable(n("input")).define("input",["html","d3format"],(function(e,n){return function(t){var i=t.form,r=t.type,a=void 0===r?"text":r,o=t.attributes,u=void 0===o?{}:o,l=t.action,c=t.getValue,b=t.title,h=t.description,_=t.format,g=t.display,w=t.submit,y=(t.options,e(v()));if(i||(i=e(p(),a)),Object.keys(u).forEach((function(e){var n=u[e];null!=n&&i.input.setAttribute(e,n)})),w&&i.append(e(m(),"string"==typeof w?w:"Submit")),i.append(e(d())),b&&i.prepend(e(f(),b)),h&&i.append(e(s(),h)),_&&(_="function"==typeof _?_:n.format(_)),l)l(i);else{var j=w?"onsubmit":"button"==a?"onclick":"checkbox"==a||"radio"==a?"onchange":"oninput";i[j]=function(e){e&&e.preventDefault();var n=c?c(i.input):i.input.value;if(i.output){var t=g?g(n):_?_(n):n;if(t instanceof window.Element){for(;i.output.hasChildNodes();)i.output.removeChild(i.output.lastChild);i.output.append(t)}else i.output.value=t}i.value=n,"oninput"!==j&&i.dispatchEvent(new CustomEvent("input",{bubbles:!0}))},"oninput"!==j&&(y.oninput=function(e){return e&&e.stopPropagation()&&e.preventDefault()}),"onsubmit"!==j&&(i.onsubmit=function(e){return e&&e.preventDefault()}),i[j]()}for(;i.childNodes.length;)y.appendChild(i.childNodes[0]);return i.append(y),i}})),t.variable(n("d3geo")).define("d3geo",["require"],(function(e){return e("d3-geo@1")})),t.variable(n("d3format")).define("d3format",["require"],(function(e){return e("d3-format@1")})),t.variable(n("topojson")).define("topojson",["require"],(function(e){return e("topojson-client@3")})),t.variable(n("world")).define("world",Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://cdn.jsdelivr.net/npm/world-atlas@1/world/110m.json");case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)})))),t.variable(n("land")).define("land",["topojson","world"],(function(e,n){return e.feature(n,n.objects.land)})),t.variable(n("countries")).define("countries",["topojson","world"],(function(e,n){return e.feature(n,n.objects.countries)})),t.variable(n("usa")).define("usa",Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://cdn.jsdelivr.net/npm/us-atlas@^2.1/us/states-10m.json");case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)})))),t.variable(n("nation")).define("nation",["topojson","usa"],(function(e,n){return e.feature(n,n.objects.nation)})),t.variable(n("states")).define("states",["topojson","usa"],(function(e,n){return e.feature(n,n.objects.states)})),t.variable(n("graticule")).define("graticule",["d3geo"],(function(e){return e.geoGraticule10()})),t.variable(n("viewof license")).define("viewof license",["md"],(function(e){var n=e(c());return n.value="MIT",n})),t.variable(n("license")).define("license",["Generators","viewof license"],(function(e,n){return e.input(n)})),t.variable(n()).define(["md"],(function(e){return e(l())})),t}t("Vd3H"),t("VRzm");function ie(){var e=Object(i.a)(["## Parallel Coordinates\n\nA [parallel coordinates plot](https://en.wikipedia.org/wiki/Parallel_coordinates) that uses `window` and `fold` transforms to convert the four dimensions of Iris flower measurements into normalized coordinates that can be visualized as `line` marks. The graphic includes an additional layer with custom `text` mark labels for the parallel axis grid lines. We render the plot as SVG by passing `{renderer:'svg'}` to the `render` method.\n"],["## Parallel Coordinates\n\nA [parallel coordinates plot](https://en.wikipedia.org/wiki/Parallel_coordinates) that uses \\`window\\` and \\`fold\\` transforms to convert the four dimensions of Iris flower measurements into normalized coordinates that can be visualized as \\`line\\` marks. The graphic includes an additional layer with custom \\`text\\` mark labels for the parallel axis grid lines. We render the plot as SVG by passing \\`{renderer:'svg'}\\` to the \\`render\\` method.\n"]);return ie=function(){return e},e}function re(){var e=Object(i.a)(["## Interactive Seattle Weather 2012-2015\n\nA scatter plot and summary histogram with linked `selections` between plots to perform cross-filtering and configure conditional color encodings.\n"],["## Interactive Seattle Weather 2012-2015\n\nA scatter plot and summary histogram with linked \\`selections\\` between plots to perform cross-filtering and configure conditional color encodings.\n"]);return re=function(){return e},e}function ae(){var e=Object(i.a)(["## Zip Codes\n\nA dot for each zip code in the United States, colored by the first digit.\n"]);return ae=function(){return e},e}function oe(){var e=Object(i.a)(["To use the same setup in your own notebooks, add a cell with the following code:\n~~~ js\nimport {vl} from '@vega/vega-lite-api'\n~~~\n"]);return oe=function(){return e},e}function ue(){var e=Object(i.a)(["\nThe cell below imports the Vega-Lite API and registers the desired versions of Vega and Vega-Lite, along with default [Vega View options](https://vega.github.io/vega/docs/api/view/#view) and [Vega-Lite configuration](https://vega.github.io/vega-lite/docs/config.html):\n"]);return ue=function(){return e},e}function le(){var e=Object(i.a)(["The [Vega-Lite JavaScript API](https://github.com/vega/vega-lite-api/) provides a convenient way to write [Vega-Lite](https://vega.github.io/vega-lite) specifications in a programmatic fashion. Scroll down for some usage examples, or browse the [Vega-Lite API example collection](https://observablehq.com/collection/@vega/vega-lite-api)!"]);return le=function(){return e},e}function ce(){var e=Object(i.a)(["# Vega-Lite API"]);return ce=function(){return e},e}function se(e,n){var t=e.module();return t.variable(n()).define(["md"],(function(e){return e(ce())})),t.variable(n()).define(["md"],(function(e){return e(le())})),t.variable(n()).define(["md"],(function(e){return e(ue())})),t.variable(n("vl")).define("vl",["require"],function(){var e=Object(o.a)(a.a.mark((function e(n){var t,i,r,o,l,c,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(["vega@5","vega-lite@3.4.0","vega-lite-api@0.1.0","vega-tooltip@0.17.0"].map((function(e){return n(e)})));case 2:return t=e.sent,i=Object(u.a)(t,4),r=i[0],o=i[1],l=i[2],c=i[3],s={config:{config:{view:{width:400,height:300},mark:{tooltip:null}}},init:function(e){e.tooltip((new c.Handler).call),e.container()&&(e.container().style["overflow-x"]="auto")},view:{loader:r.loader({baseURL:"https://vega.github.io/vega-datasets/"}),renderer:"canvas"}},e.abrupt("return",l.register(r,o,s));case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),t.variable(n()).define(["md"],(function(e){return e(oe())})),t.variable(n()).define(["md"],(function(e){return e(ae())})),t.variable(n()).define(["vl","width"],(function(e,n){return e.markSquare({size:2,opacity:1}).data("data/zipcodes.csv").transform(e.calculate("substring(datum.zip_code, 0, 1)").as("digit")).project(e.projection("albersUsa")).encode(e.longitude().fieldQ("longitude"),e.latitude().fieldQ("latitude"),e.color().fieldN("digit")).width(n).height(Math.floor(n/1.75)).autosize({type:"fit-x",contains:"padding"}).config({view:{stroke:null}}).render()})),t.variable(n()).define(["md"],(function(e){return e(re())})),t.variable(n()).define(["vl","width"],(function(e,n){var t=e.selectInterval().encodings("x"),i=e.selectMulti().encodings("color"),r={domain:["sun","fog","drizzle","rain","snow"],range:["#e7ba52","#a7a7a7","#aec7e8","#1f77b4","#9467bd"]},a=e.markPoint({filled:!0}).encode(e.color().value("lightgray").if(t,e.color().fieldN("weather").scale(r).title("Weather")),e.size().fieldQ("precipitation").scale({domain:[-1,50],range:[10,500]}).title("Precipitation"),e.order().fieldQ("precipitation").sort("descending"),e.x().timeMD("date").axis({title:"Date",format:"%b"}),e.y().fieldQ("temp_max").scale({domain:[-5,40]}).axis({title:"Maximum Daily Temperature (¬∞C)"})).width(n).height(300).select(t).transform(e.filter(i)),o=e.markBar().encode(e.color().value("lightgray").if(i,e.color().fieldN("weather").scale(r).title("Weather")),e.x().count(),e.y().fieldN("weather").scale({domain:r.domain}).title("Weather")).width(n).select(i).transform(e.filter(t));return e.vconcat(a,o).data("data/seattle-weather.csv").autosize({type:"fit-x",contains:"padding"}).render()})),t.variable(n()).define(["md"],(function(e){return e(ie())})),t.variable(n()).define(["vl","width"],(function(e,n){var t=e.markLine({strokeWidth:1.5,opacity:.5}).encode(e.color().fieldN("species").sort("descending"),e.detail().fieldN("index"),e.x().fieldO("key").scale({type:"point",padding:0}).axis({domain:!1,ticks:!1,title:!1,grid:!0,gridColor:"#888",labelAngle:0,labelPadding:8,labelFontWeight:"bold"}),e.y().fieldQ("fraction").axis(null)),i=e.markText({dx:-2,align:"right",baseline:"middle"}).transform(e.groupby("key").aggregate(e.min("value").as("min"),e.max("value").as("max")),e.fold("min","max").as("op","value"),e.groupby("key").window(e.percent_rank("value").as("fraction"))).encode(e.x().fieldN("key"),e.y().fieldQ("fraction").axis(null),e.text().fieldN("value"));return e.layer(t,i).data("data/iris.json").transform(e.window(e.row_number().as("index")),e.fold(["petalLength","petalWidth","sepalLength","sepalWidth"]),e.groupby("key").join(e.min("value").as("min"),e.max("value").as("max")),e.calculate("(datum.value - datum.min) / (datum.max - datum.min)").as("fraction")).width(n).height(300).autosize({type:"fit-x",contains:"padding"}).render({renderer:"svg"})})),t}function fe(){var e=Object(i.a)(["<td>",""]);return fe=function(){return e},e}function de(){var e=Object(i.a)(["<tr>\n  ","\n"]);return de=function(){return e},e}function me(){var e=Object(i.a)(["<th>",""]);return me=function(){return e},e}function pe(){var e=Object(i.a)(["\n<table>\n<thead>\n<tr>\n","\n<tbody>\n","\n"]);return pe=function(){return e},e}function ve(){var e=Object(i.a)(["### Generic utility libraries and functions"]);return ve=function(){return e},e}function be(){var e=Object(i.a)(["### Annex 4: Other functions"]);return be=function(){return e},e}function he(){var e=Object(i.a)(["### Annex 3:  Likelihood and probability calculations"]);return he=function(){return e},e}function _e(){var e=Object(i.a)(["### Annex 2:  Computation of comparison vectors"]);return _e=function(){return e},e}function ge(){var e=Object(i.a)(['## Annex: Code\n\nThis is the code I used to compute the log likelihood:\n\n```javascript\n{\n function log_probability_of_element_of_gamma(elem, pi) {\n    let prob =  lambda * pi["1"][elem] + (1-lambda) * pi["0"][elem]\n    return Math.log(prob)\n  }\n  \n  function log_probability_of_comparison(comparison_vector) {\n    let elem = comparison_vector["ùõæ1"]\n    let ln_prob_1 = log_probability_of_element_of_gamma(elem, pi_mob)\n    \n    elem = comparison_vector["ùõæ2"]\n    let ln_prob_2 = log_probability_of_element_of_gamma(elem, pi_surname)\n    \n    return ln_prob_1 + ln_prob_2\n  }\n  \n  let log_probs_of_rows = comparison_vectors.map(cv => log_probability_of_comparison(cv))\n  \n  return log_probs_of_rows.reduce((a,b) => a + b)\n}\n```\n\nand the code to compute the probability of a match:\n\n\n```javascript \nget_estimated_match_probability = function(comparison_vector) {\n  let gamma1 = comparison_vector["ùõæ1"]\n  let gamma2 = comparison_vector["ùõæ2"]\n  \n  let prob_match_1 = lambda * pi_mob["1"][gamma1]\n  let prob_no_match_1 = (1-lambda) * pi_mob["0"][gamma1]\n  let sum_1 = prob_match_1 + prob_no_match_1\n\n  \n  let prob_match_2 = lambda * pi_surname["1"][gamma1] \n  let prob_no_match_2 = (1-lambda) * pi_surname["0"][gamma1]\n  let sum_2 = prob_match_2 + prob_no_match_2\n  \n  // Is the following calculation correct?\n  let lr = (prob_match_1 * prob_match_2) / (prob_match_1*prob_match_2 + prob_no_match_1*prob_no_match_2)  \n  \n  return lr\n \n}\n```\n\n'],['## Annex: Code\n\nThis is the code I used to compute the log likelihood:\n\n\\`\\`\\`javascript\n{\n function log_probability_of_element_of_gamma(elem, pi) {\n    let prob =  lambda * pi["1"][elem] + (1-lambda) * pi["0"][elem]\n    return Math.log(prob)\n  }\n  \n  function log_probability_of_comparison(comparison_vector) {\n    let elem = comparison_vector["ùõæ1"]\n    let ln_prob_1 = log_probability_of_element_of_gamma(elem, pi_mob)\n    \n    elem = comparison_vector["ùõæ2"]\n    let ln_prob_2 = log_probability_of_element_of_gamma(elem, pi_surname)\n    \n    return ln_prob_1 + ln_prob_2\n  }\n  \n  let log_probs_of_rows = comparison_vectors.map(cv => log_probability_of_comparison(cv))\n  \n  return log_probs_of_rows.reduce((a,b) => a + b)\n}\n\\`\\`\\`\n\nand the code to compute the probability of a match:\n\n\n\\`\\`\\`javascript \nget_estimated_match_probability = function(comparison_vector) {\n  let gamma1 = comparison_vector["ùõæ1"]\n  let gamma2 = comparison_vector["ùõæ2"]\n  \n  let prob_match_1 = lambda * pi_mob["1"][gamma1]\n  let prob_no_match_1 = (1-lambda) * pi_mob["0"][gamma1]\n  let sum_1 = prob_match_1 + prob_no_match_1\n\n  \n  let prob_match_2 = lambda * pi_surname["1"][gamma1] \n  let prob_no_match_2 = (1-lambda) * pi_surname["0"][gamma1]\n  let sum_2 = prob_match_2 + prob_no_match_2\n  \n  // Is the following calculation correct?\n  let lr = (prob_match_1 * prob_match_2) / (prob_match_1*prob_match_2 + prob_no_match_1*prob_no_match_2)  \n  \n  return lr\n \n}\n\\`\\`\\`\n\n']);return ge=function(){return e},e}function we(){var e=Object(i.a)(["\frac{p1 p2}{p1 p2 + n1 n2} = \frac{1}{1 + \frac{n1 n2}{p1 p2}}"],["\\frac{p1 p2}{p1 p2 + n1 n2} = \\frac{1}{1 + \\frac{n1 n2}{p1 p2}}"]);return we=function(){return e},e}function ye(){var e=Object(i.a)(["n2 = (1-lambda) P(gamma_2|pi_{2,m=0}) "],["n2 = (1-\\lambda) P(\\gamma_2|\\pi_{2,m=0}) "]);return ye=function(){return e},e}function je(){var e=Object(i.a)(["<br>"]);return je=function(){return e},e}function xe(){var e=Object(i.a)(["n1 = (1-lambda) P(gamma_2|pi_{2,m=0}) "],["n1 = (1-\\lambda) P(\\gamma_2|\\pi_{2,m=0}) "]);return xe=function(){return e},e}function ke(){var e=Object(i.a)(["<br>"]);return ke=function(){return e},e}function Oe(){var e=Object(i.a)(["p2 = lambda P(gamma_2|pi_{2,m=1}) "],["p2 = \\lambda P(\\gamma_2|\\pi_{2,m=1}) "]);return Oe=function(){return e},e}function Me(){var e=Object(i.a)(["<br>"]);return Me=function(){return e},e}function Ae(){var e=Object(i.a)(["p1 = lambda P(gamma_1|pi_{1,m=1})"],["p1 = \\lambda P(\\gamma_1|\\pi_{1,m=1})"]);return Ae=function(){return e},e}function Se(){var e=Object(i.a)(["gamma_i"],["\\gamma_i"]);return Se=function(){return e},e}function Ge(){var e=Object(i.a)(["P(m)"]);return Ge=function(){return e},e}function Ce(){var e=Object(i.a)(["Given the parameter values you've selected, we can now compute the probability that we have a match for each record comparison, ",".\n\nWe can write the probabilities of observing "," given our parameters, and whether the record is a match:\n\n","\n\n","\n\n","\n\n","\n\n","\n\n","\n\n","\n\n\nThe probability of a given record being a match is then:\n\n",".\n"]);return Ce=function(){return e},e}function De(){var e=Object(i.a)(["gamma_2"],["\\gamma_2"]);return De=function(){return e},e}function Te(){var e=Object(i.a)(["pi_{2,m=1}"],["\\pi_{2,m=1}"]);return Te=function(){return e},e}function Pe(){var e=Object(i.a)(["pi_{2,m=0}"],["\\pi_{2,m=0}"]);return Pe=function(){return e},e}function qe(){var e=Object(i.a)(["This chart shows "," and ",", the discrete distributions you've chosen for ",", the `surname` comparison vector."],["This chart shows "," and ",", the discrete distributions you've chosen for ",", the \\`surname\\` comparison vector."]);return qe=function(){return e},e}function Ne(){var e=Object(i.a)(["gamma_1"],["\\gamma_1"]);return Ne=function(){return e},e}function Ee(){var e=Object(i.a)(["pi_{1,m=1}"],["\\pi_{1,m=1}"]);return Ee=function(){return e},e}function Ie(){var e=Object(i.a)(["pi_{1,m=0}"],["\\pi_{1,m=0}"]);return Ie=function(){return e},e}function Le(){var e=Object(i.a)(["This chart shows "," and ",", the discrete distributions that you've chosen for ",", the `mob` comparison vector."],["This chart shows "," and ",", the discrete distributions that you've chosen for ",", the \\`mob\\` comparison vector."]);return Le=function(){return e},e}function ze(){var e=Object(i.a)(["Here's a history of the values of log likelihood as you've been adjusting the sliders:"]);return ze=function(){return e},e}function Ve(){var e=Object(i.a)(["The log likelihood given these parameters is ",""]);return Ve=function(){return e},e}function We(){var e=Object(i.a)(["pi_{i,m}"],["\\pi_{i,m}"]);return We=function(){return e},e}function Be(){var e=Object(i.a)(["lambda"],["\\lambda"]);return Be=function(){return e},e}function Fe(){var e=Object(i.a)(["To estimate which record comparisons are matches, we need to estimate the unknown parameters, which are "," and the parameters of the four discrete distributions ",".\n\nThere's an algorithm called the Expectation Maximisation algorithm which can solve this problem iteratively.\n\nIn this notebook, rather than implement this algorithm, we will simply let you choose the parameters to try and maximise the log likelihood manually.  \n\n## Estimating matches"]);return Fe=function(){return e},e}function Re(){var e=Object(i.a)(["k"]);return Re=function(){return e},e}function Ue(){var e=Object(i.a)(["lambda (pi_{i,m=1}|gamma_i)  + (1-lambda) (pi_{i,m=0}|gamma_i)"],["\\lambda (\\pi_{i,m=1}|\\gamma_i)  + (1-\\lambda) (\\pi_{i,m=0}|\\gamma_i)"]);return Ue=function(){return e},e}function Ye(){var e=Object(i.a)(["prod_{i=1}^{N_{mathcal{A}}} prod_{j=1}^{N_{mathcal{B}}}left{sum_{m=0}^{1} lambda^{m}(1-lambda)^{1-m} prod_{k=1}^{K}left(prod_{ell=0}^{L_{k}-1} pi_{k m ell}^{1left{gamma_{k}(i, j)=ell\right}}\right)^{1-delta_{k}(i, j)}\right}"],["\\prod_{i=1}^{N_{\\mathcal{A}}} \\prod_{j=1}^{N_{\\mathcal{B}}}\\left\\{\\sum_{m=0}^{1} \\lambda^{m}(1-\\lambda)^{1-m} \\prod_{k=1}^{K}\\left(\\prod_{\\ell=0}^{L_{k}-1} \\pi_{k m \\ell}^{1\\left\\{\\gamma_{k}(i, j)=\\ell\\right\\}}\\right)^{1-\\delta_{k}(i, j)}\\right\\}"]);return Ye=function(){return e},e}function He(){var e=Object(i.a)(["These assumptions are all we need to define the equation for the likelihood.  The equation looks quite complicated (see page 356 [here](https://imai.fas.harvard.edu/research/files/linkage.pdf)):\n\n","\n\nBut expressed in words it's quite simple - approximately:\n\n- For each element of the comparison vector, the probability of the observed outcome is ","\n- Compute this probability for each of the "," elements of the comparison vector in the row, and multiply together.  This represents the likelihood of the row\n- Compute this for each row, and multiply together\n\n"]);return He=function(){return e},e}function Je(){var e=Object(i.a)([" Here are the comparison vectors for this data:\n\n","\n\nEach row represents the comparison vector, which has two elements [ùõæ1, ùõæ2].  \n\n"]);return Je=function(){return e},e}function Ke(){var e=Object(i.a)(["gamma_i"],["\\gamma_i"]);return Ke=function(){return e},e}function Qe(){var e=Object(i.a)(["pi_{i,m=0}"],["\\pi_{i,m=0}"]);return Qe=function(){return e},e}function Ze(){var e=Object(i.a)(["gamma_i"],["\\gamma_i"]);return Ze=function(){return e},e}function Xe(){var e=Object(i.a)(["pi_{i,m=1}"],["\\pi_{i,m=1}"]);return Xe=function(){return e},e}function $e(){var e=Object(i.a)(["i"]);return $e=function(){return e},e}function en(){var e=Object(i.a)(["gamma_2 = 0"],["\\gamma_2 = 0"]);return en=function(){return e},e}function nn(){var e=Object(i.a)(["gamma_2 = 0.5"],["\\gamma_2 = 0.5"]);return nn=function(){return e},e}function tn(){var e=Object(i.a)(["gamma_2 = 1"],["\\gamma_2 = 1"]);return tn=function(){return e},e}function rn(){var e=Object(i.a)(["gamma_1 = 0"],["\\gamma_1 = 0"]);return rn=function(){return e},e}function an(){var e=Object(i.a)(["gamma_1 = 1"],["\\gamma_1 = 1"]);return an=function(){return e},e}function on(){var e=Object(i.a)(["gamma = [gamma_1, gamma_2]"],["\\gamma = [\\gamma_1, \\gamma_2]"]);return on=function(){return e},e}function un(){var e=Object(i.a)(["k=2"]);return un=function(){return e},e}function ln(){var e=Object(i.a)(["gamma"],["\\gamma"]);return ln=function(){return e},e}function cn(){var e=Object(i.a)(["To set this up as a maximum likelihood estimation problem, we need to make some assumptions about the structure of the problem, and choose some parameters to estimate.\n\nFirst, we will designate Œª the proportion of comparisons which are matches.  This is an unknown parameter to be estimated.  In the case of this data, the true Œª is ",".\n\nNext, we will create the concept of a _comparison vector_, which is a way of encoding record comparisons into a vector.  \n\nIn this simple example our comparison vector, "," will be of length "," , i.e. "," and will encode the following two rules:\n\n- If `mob` matches,  "," else ","\n- If `surname` matches exactly  ",". If it is similar ",".  Otherwise ","\n\n\nWe will then assume that element "," of the comparison vector is a draw from one of two discrete distributions:\n\n",", the discrete distribution of "," when the records match\n\nand \n\n\n",", the discrete distribution of "," when the records do not match\n\n"],["To set this up as a maximum likelihood estimation problem, we need to make some assumptions about the structure of the problem, and choose some parameters to estimate.\n\nFirst, we will designate Œª the proportion of comparisons which are matches.  This is an unknown parameter to be estimated.  In the case of this data, the true Œª is ",".\n\nNext, we will create the concept of a _comparison vector_, which is a way of encoding record comparisons into a vector.  \n\nIn this simple example our comparison vector, "," will be of length "," , i.e. "," and will encode the following two rules:\n\n- If \\`mob\\` matches,  "," else ","\n- If \\`surname\\` matches exactly  ",". If it is similar ",".  Otherwise ","\n\n\nWe will then assume that element "," of the comparison vector is a draw from one of two discrete distributions:\n\n",", the discrete distribution of "," when the records match\n\nand \n\n\n",", the discrete distribution of "," when the records do not match\n\n"]);return cn=function(){return e},e}function sn(){var e=Object(i.a)(["<br>"]);return sn=function(){return e},e}function fn(){var e=Object(i.a)(["","\n\n","\n\n\n\nFinally, here are all the possible record comparisons:\n\n",""]);return fn=function(){return e},e}function dn(){var e=Object(i.a)(["**Real matches**\n\nThese are the records which match in reality. You only need to include records which match, i.e. where label = 1.  These are the unknowns the model is trying to estimate \n"]);return dn=function(){return e},e}function mn(){var e=Object(i.a)(["\n\n","\n\n\n"]);return mn=function(){return e},e}function pn(){var e=Object(i.a)(["**Right table:**"]);return pn=function(){return e},e}function vn(){var e=Object(i.a)(["",""]);return vn=function(){return e},e}function bn(){var e=Object(i.a)(["**Left table:**"]);return bn=function(){return e},e}function hn(){var e=Object(i.a)(["## Input data\n\nConsider two tables, which we are trying to match to one another.   `mob` stands for month of birth.\n**Note**: You can edit this data so long as you keep the column names the same.\n\n"],["## Input data\n\nConsider two tables, which we are trying to match to one another.   \\`mob\\` stands for month of birth.\n**Note**: You can edit this data so long as you keep the column names the same.\n\n"]);return hn=function(){return e},e}function _n(){var e=Object(i.a)(["This notebook is an interactive implementation of the Fellegi-Sunter model of record linkage, with record linkage probabilities estimated using the Expectation Maximisation (EM) algorithm.  \n\nThis is an unsupervised approach to finding matching records, which seems like magic to me - so hopefully this notebook helps demystify how this is possible.\n"]);return _n=function(){return e},e}function gn(){var e=Object(i.a)(["# Unsupervised probabalistic data matching using the Expectation Maximisation algorithm"]);return gn=function(){return e},e}function wn(e,n){var t=e.module();t.variable(n("title")).define("title",["md"],(function(e){return e(gn())})),t.variable(n("out_1")).define("out_1",["md"],(function(e){return e(_n())})),t.variable(n("out_2")).define("out_2",["md"],(function(e){return e(hn())})),t.variable(n("out_3")).define("out_3",["md"],(function(e){return e(bn())})),t.variable(n("viewof left_table_csv")).define("viewof left_table_csv",["textarea","data_left_template"],(function(e,n){return e({value:n,rows:6,width:"100%"})})),t.variable(n("left_table_csv")).define("left_table_csv",["Generators","viewof left_table_csv"],(function(e,n){return e.input(n)})),t.variable(n("out_4")).define("out_4",["md","table","data_left"],(function(e,n,t){return e(vn(),n(t))})),t.variable(n("out_5")).define("out_5",["md"],(function(e){return e(pn())})),t.variable(n("viewof right_table_csv")).define("viewof right_table_csv",["textarea","data_right_template"],(function(e,n){return e({value:n,rows:6,width:"100%"})})),t.variable(n("right_table_csv")).define("right_table_csv",["Generators","viewof right_table_csv"],(function(e,n){return e.input(n)})),t.variable(n("out_6")).define("out_6",["md","table","data_right"],(function(e,n,t){return e(mn(),n(t))})),t.variable(n("out_7")).define("out_7",["md"],(function(e){return e(dn())})),t.variable(n("viewof match_pairs_csv")).define("viewof match_pairs_csv",["textarea","match_pairs_template"],(function(e,n){return e({value:n,rows:6,width:"100%"})})),t.variable(n("match_pairs_csv")).define("match_pairs_csv",["Generators","viewof match_pairs_csv"],(function(e,n){return e.input(n)})),t.variable(n("out_8")).define("out_8",["md","html","table","match_pairs","combinations"],(function(e,n,t,i,r){return e(fn(),n(sn()),t(i),t(r))})),t.variable(n("out_9")).define("out_9",["md","num_fmt","true_lambda","tex"],(function(e,n,t,i){return e(cn(),n(t),i(ln()),i(un()),i(on()),i(an()),i(rn()),i(tn()),i(nn()),i(en()),i($e()),i(Xe()),i(Ze()),i(Qe()),i(Ke()))})),t.variable(n("out_10")).define("out_10",["md","table","comparison_vectors"],(function(e,n,t){return e(Je(),n(t))})),t.variable(n("out_11")).define("out_11",["md","tex"],(function(e,n){return e(He(),n(Ye()),n(Ue()),n(Re()))})),t.variable(n("out_12")).define("out_12",["md","tex"],(function(e,n){return e(Fe(),n(Be()),n(We()))})),t.variable(n("viewof lambda")).define("viewof lambda",["slider"],(function(e){return e({title:"Choose Œª, the proportion of combinations which are matches",min:0,max:1,step:.01,value:.5})})),t.variable(n("lambda")).define("lambda",["Generators","viewof lambda"],(function(e,n){return e.input(n)})),t.variable(n("viewof pi1_1_m1")).define("viewof pi1_1_m1",["slider"],(function(e){return e({title:"Month of birth comparison, probability month of birth matches given m=1",min:0,max:1,step:.01,value:.5})})),t.variable(n("pi1_1_m1")).define("pi1_1_m1",["Generators","viewof pi1_1_m1"],(function(e,n){return e.input(n)})),t.variable(n("viewof pi1_1_m0")).define("viewof pi1_1_m0",["slider"],(function(e){return e({title:"Month of birth comparison, probability month of birth matches given records DO NOT match",min:0,max:1,step:.01,value:.5})})),t.variable(n("pi1_1_m0")).define("pi1_1_m0",["Generators","viewof pi1_1_m0"],(function(e,n){return e.input(n)})),t.variable(n("viewof pi2_1_m1")).define("viewof pi2_1_m1",["slider"],(function(e){return e({title:"Surname comparison, probability field exactly matches given records match",min:0,max:1,step:.01,value:.3})})),t.variable(n("pi2_1_m1")).define("pi2_1_m1",["Generators","viewof pi2_1_m1"],(function(e,n){return e.input(n)})),t.variable(n("viewof pi2_05_m1")).define("viewof pi2_05_m1",["slider"],(function(e){return e({title:"Surname comparison, probability fields similar given records match",min:0,max:1,step:.01,value:.3})})),t.variable(n("pi2_05_m1")).define("pi2_05_m1",["Generators","viewof pi2_05_m1"],(function(e,n){return e.input(n)})),t.variable(n("viewof pi2_1_m0")).define("viewof pi2_1_m0",["slider"],(function(e){return e({title:"Surname comparison, probability field exactly matches given records DO NOT match",min:0,max:1,step:.01,value:.3})})),t.variable(n("pi2_1_m0")).define("pi2_1_m0",["Generators","viewof pi2_1_m0"],(function(e,n){return e.input(n)})),t.variable(n("viewof pi2_05_m0")).define("viewof pi2_05_m0",["slider"],(function(e){return e({title:"Surname comparison, probability fields similar given records DO NOT match",min:0,max:1,step:.01,value:.3})})),t.variable(n("pi2_05_m0")).define("pi2_05_m0",["Generators","viewof pi2_05_m0"],(function(e,n){return e.input(n)})),t.variable(n("out_13")).define("out_13",["md","num_fmt","log_likelihood"],(function(e,n,t){return e(Ve(),n(t))})),t.variable(n("out_14")).define("out_14",["md"],(function(e){return e(ze())})),t.variable(n("ll_chart")).define("ll_chart",["log_likelihood","history_ll","vl"],(function(e,n,t){var i=n.map((function(e,n){return{log_likelihood:e.log_likelihood,i:n}}));return i=i.filter((function(e){return e.log_likelihood>-1e6})),t.markLine().data(i).encode(t.y().field("log_likelihood").type("quantitative").scale({zero:!1}),t.x().field("i").type("quantitative")).height(200).render()})),t.variable(n("out_15")).define("out_15",["md","tex"],(function(e,n){return e(Le(),n(Ie()),n(Ee()),n(Ne()))})),t.variable(n("pi_chart_1")).define("pi_chart_1",["pi1_1_m1","pi1_1_m0","vl"],(function(e,n,t){var i=[{"ùõæ_val":"1",probability:e,m:1,rule:"mob"},{"ùõæ_val":"0",probability:1-e,m:1,rule:"mob"},{"ùõæ_val":"1",probability:n,m:0,rule:"mob"},{"ùõæ_val":"0",probability:1-n,m:0,rule:"mob"}];return t.markBar().data(i).encode(t.y().field("ùõæ_val").type("nominal"),t.x().field("probability").type("quantitative"),t.column().fieldN("m").title(null),t.color().fieldN("m")).height(30).width(100).render()})),t.variable(n("out_16")).define("out_16",["md","tex"],(function(e,n){return e(qe(),n(Pe()),n(Te()),n(De()))})),t.variable(n("pi_chart_2")).define("pi_chart_2",["pi2_1_m1","pi2_05_m1","pi2_1_m0","pi2_05_m0","vl"],(function(e,n,t,i,r){var a=[{"ùõæ_val":"1",probability:e,m:1,rule:"surname"},{"ùõæ_val":"0.5",probability:n,m:1,rule:"surname"},{"ùõæ_val":"0",probability:1-e-n,m:1,rule:"surname"},{"ùõæ_val":"1",probability:t,m:0,rule:"surname"},{"ùõæ_val":"0.5",probability:i,m:0,rule:"surname"},{"ùõæ_val":"0",probability:1-t-i,m:0,rule:"surname"}];return r.markBar().data(a).encode(r.y().field("ùõæ_val").type("nominal"),r.x().field("probability").type("quantitative"),r.column().fieldN("m").title(null),r.color().fieldN("m")).height(30).width(100).render()})),t.variable(n("out_17")).define("out_17",["md","tex","html"],(function(e,n,t){return e(Ce(),n(Ge()),n(Se()),n(Ae()),t(Me()),n(Oe()),t(ke()),n(xe()),t(je()),n(ye()),n(we()))})),t.variable(n("out_18")).define("out_18",["combinations","get_comparison_vector","deepcopy","num_fmt","get_estimated_match_probability","table"],(function(e,n,t,i,r,a){var o=e.map((function(e){var a=n(e);return(e=t(e))["ùõæ1"]=a["ùõæ1"],e["ùõæ2"]=a["ùõæ2"],e.prob_match=i(r(e)),e}));return o.columns=Object.keys(o[0]),a(o)})),t.variable(n("out_19")).define("out_19",["md"],(function(e){return e(ge())})),t.variable(n("data_left_template")).define("data_left_template",(function(){return"row_id_l,mob_l,surname_l\n1,10,Linacre\n2,7,Smith\n"})),t.variable(n("data_right_template")).define("data_right_template",(function(){return"row_id_r,mob_r,surname_r\n1,10,Linacer\n2,8,Jones\n3,7,Smith\n"})),t.variable(n("data_left")).define("data_left",["mutable history_ll","d3","left_table_csv"],(function(e,n,t){return e.value=[],n.csvParse(t)})),t.variable(n("data_right")).define("data_right",["mutable history_ll","d3","right_table_csv"],(function(e,n,t){return e.value=[],n.csvParse(t)})),t.variable(n("match_pairs_template")).define("match_pairs_template",(function(){return"row_id_l,row_id_r,label\n1,1,1\n2,3,1\n"})),t.variable(n("matches")).define("matches",["mutable history_ll","d3","match_pairs_csv"],(function(e,n,t){return e.value=[],n.csvParse(t)})),t.variable(n("combinations")).define("combinations",["db","alasql","sql_with_cols"],(function(e,n,t){n("DROP TABLE if exists combinations");var i=n("select * from df_l\n  cross join df_r\n  left join matches as m\n  on df_l.row_id_l = m.row_id_l and df_r.row_id_r = m.row_id_r\n  ");return i=i.map((function(e){return e.label||(e.label="0"),e})),n("CREATE TABLE combinations"),n.tables.combinations.data=i,t("\n  select * from combinations\n\n")})),t.variable(n()).define(["md"],(function(e){return e(_e())})),t.variable(n("get_comparison_vector")).define("get_comparison_vector",["month_of_birth","surname"],(function(e,n){return function(t){return{"ùõæ1":e(t),"ùõæ2":n(t)}}})),t.variable(n("month_of_birth")).define("month_of_birth",(function(){return function(e){return+(e.mob_l==e.mob_r)}})),t.variable(n("surname")).define("surname",["levenshtein"],(function(e){return function(n){return n.surname_l==n.surname_r?1:e.get(n.surname_l,n.surname_r)<3?.5:0}})),t.variable(n("comparison_vectors")).define("comparison_vectors",["combinations","get_comparison_vector"],(function(e,n){var t=e.map((function(e){return n(e)}));return t.columns=Object.keys(t[0]),t})),t.variable(n("match_pairs")).define("match_pairs",["db","sql_with_cols"],(function(e,n){return n("\n\nselect df_l.row_id_l, df_r.row_id_r \nfrom df_l\n  cross join df_r\n  left join matches as m\non df_l.row_id_l = m.row_id_l and df_r.row_id_r = m.row_id_r\nwhere m.label = '1'\n\n")})),t.variable(n("real_matches")).define("real_matches",["matches"],(function(e){return e.filter((function(e){return 1==e.match})).map((function(e){return delete e.match,e}))})),t.variable(n()).define(["md"],(function(e){return e(he())})),t.variable(n("true_lambda")).define("true_lambda",["combinations","sql_return_scalar"],(function(e,n){return n("\n select count(*) as count_match\nfrom combinations\n where label = '1' \n")/n("\nselect count(*) from combinations\n")})),t.variable(n("pi_surname")).define("pi_surname",["pi2_1_m1","pi2_05_m1","pi2_1_m0","pi2_05_m0"],(function(e,n,t,i){return{1:{1:e,.5:n,0:1-e-n},0:{1:t,.5:i,0:1-t-i}}})),t.variable(n("pi_mob")).define("pi_mob",["pi1_1_m1","pi1_1_m0"],(function(e,n){return{1:{1:e,0:1-e},0:{1:n,0:1-n}}})),t.variable(n("get_estimated_match_probability")).define("get_estimated_match_probability",["lambda","pi_mob","pi_surname"],(function(e,n,t){return function(i){var r=i["ùõæ1"],a=(i["ùõæ2"],e*n[1][r]),o=(1-e)*n[0][r],u=e*t[1][r],l=(1-e)*t[0][r];return a*u/(a*u+o*l)}})),t.variable(n("log_likelihood")).define("log_likelihood",["lambda","pi_mob","pi_surname","comparison_vectors"],(function(e,n,t,i){function r(n,t){var i=e*t[1][n]+(1-e)*t[0][n];return Math.log(i)}return i.map((function(e){return r((i=e)["ùõæ1"],n)+r(i["ùõæ2"],t);var i})).reduce((function(e,n){return e+n}))})),t.variable(n()).define(["md"],(function(e){return e(be())})),t.define("initial history_ll",(function(){return[]})),t.variable(n("mutable history_ll")).define("mutable history_ll",["Mutable","initial history_ll"],(function(e,n){return new e(n)})),t.variable(n("history_ll")).define("history_ll",["mutable history_ll"],(function(e){return e.generator})),t.variable(n()).define(["history_ll","log_likelihood"],(function(e,n){e.push({log_likelihood:n})})),t.variable(n("db")).define("db",["alasql","data_left","data_right","matches"],(function(e,n,t,i){var r=e("DROP TABLE if exists df_l");return e("CREATE TABLE df_l"),e("DROP TABLE if exists df_r"),e("CREATE TABLE df_r"),e("DROP TABLE if exists matches"),e("CREATE TABLE matches"),e.tables.df_l.data=n,e.tables.df_r.data=t,e.tables.matches.data=i,r})),t.variable(n()).define(["md"],(function(e){return e(ve())})),t.variable(n("sql_with_cols")).define("sql_with_cols",["alasql"],(function(e){return function(n){var t=e(n);return t.columns=Object.keys(t[0]),t}})),t.variable(n("table")).define("table",["html"],(function(e){return function(n){return e(pe(),n.columns.map((function(n){return e(me(),n)})),n.map((function(n){return e(de(),Object.keys(n).map((function(t){return e(fe(),n[t])})))})))}})),t.variable(n("alasql")).define("alasql",["require"],(function(e){return e("alasql")})),t.variable(n("sql_return_scalar")).define("sql_return_scalar",["alasql"],(function(e){return function(n){var t=e(n);return(t=t[0])[Object.keys(t)[0]]}})),t.variable(n("d3")).define("d3",["require"],(function(e){return e("d3")})),t.variable(n("num_fmt")).define("num_fmt",["d3"],(function(e){return e.format(",.3f")})),t.variable(n("levenshtein")).define("levenshtein",["require"],(function(e){return e("fast-levenshtein")}));var i=e.module(te);t.import("slider",i),t.import("textarea",i);var r=e.module(se);return t.import("vl",r),t.variable(n("vegalite")).define("vegalite",["require"],(function(e){return e("@observablehq/vega-lite@0.2")})),t.variable(n("deepcopy")).define("deepcopy",(function(){return function(e){return JSON.parse(JSON.stringify(e))}})),t}var yn=t("56Sw"),jn=t("qKvR");t.d(n,"frontmatter",(function(){return xn}));var xn={title:"Unsupervised probabalistic data matching using the Expectation Maximisation algorithm",post_date:"2019-11-03",code_url:"https://observablehq.com/@robinl/unsupervised-probabalistic-data-matching-using-the-expec/",post_type:"obs",post_category:"data"},kn=["title","out_1","out_2","out_3","viewof left_table_csv","out_4","out_5","viewof right_table_csv","out_6","out_7","viewof match_pairs_csv","out_8","out_9","out_10","out_11","out_12","viewof lambda","viewof pi1_1_m1","viewof pi1_1_m0","viewof pi2_1_m1","viewof pi2_05_m1","viewof pi2_1_m0","viewof pi2_05_m0","out_13","out_14","ll_chart","out_15","pi_chart_1","out_16","pi_chart_2","out_17","out_18","out_19"];n.default=function(e){e.data;return Object(jn.c)(yn.a,{define:wn,output_order:kn,post_frontmatter:xn})}}}]);
//# sourceMappingURL=component---src-pages-linkage-1-jsx-001feb97e2302f695cc9.js.map